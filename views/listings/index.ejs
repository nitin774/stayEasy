<% layout('layout/boilerplate') -%>
<body>
    <div class="catbar">
      <div class="container cat-inner px-3 px-md-4">
        <nav class="categories" aria-label="Categories">
          <div class="cat active"><i class="bi bi-house-door"></i><a href="#">Bed & breakfasts</a></div>
          <div class="cat"><i class="bi bi-tree"></i><span>Camping</span></div>
          <div class="cat"><i class="bi bi-cast"></i><span>Castles</span></div>
          <div class="cat"><i class="bi bi-globe"></i><span>Top of the world</span></div>
          <div class="cat"><i class="bi bi-snow"></i><span>Arctic</span></div>
          <div class="cat"><i class="bi bi-cup"></i><span>Vineyards</span></div>
          <div class="cat"><i class="bi bi-hexagon"></i><span>Domes</span></div>
          <div class="cat"><i class="bi bi-brush"></i><span>Design</span></div>
          <div class="cat"><i class="bi bi-triangle"></i><span>A-frames</span></div>
        </nav>

        <button class="filter-btn" aria-label="Filters">
          <i class="bi bi-sliders"></i>
          <span>Filters</span>
        </button>

        <label class="toggle" title="Display total before taxes">
          <span>Display total before taxes</span>
          <span class="switch">
            <input type="checkbox" id="switch"/>
            <span class="slider"></span>
          </span>
        </label>
      </div>
    </div>
    <!-- Search Results Header -->
    <% if(typeof hasSearch !== 'undefined' && hasSearch) { %>
    <div class="search-results-header mt-3 mb-3">
        <% if(typeof searchTerm !== 'undefined' && searchTerm) { %>
            <h4>Search Results for "<%= searchTerm %>"</h4>
            <p class="text-muted"><%= allListings.length %> listing(s) found</p>
        <% } %>
    </div>
    <% } %>

    <!-- Dynamic Search Results Header (for client-side search) -->
    <div id="dynamic-search-header" class="search-results-header mt-3 mb-3" style="display: none;">
        <h4 id="search-title"></h4>
        <p id="search-count" class="text-muted"></p>
    </div>

    <!-- No Results Message -->
    <div id="no-results" class="text-center mt-5" style="display: none;">
        <div class="alert alert-info">
            <i class="bi bi-search"></i>
            <h5>No listings found</h5>
            <p>Sorry, no listings match your search criteria. Try searching for a different location.</p>
        </div>
    </div>

    <!-- Listings Container -->
    <div id="listings-container" class="row row-cols-md-3 row-cols-sm-2 row-cols-1 mt-3">
        <% if(allListings && allListings.length > 0) { %>
            <% for(let listing of allListings){ %>
            <a href="/listings/<%= listing._id %>" class="listing-link">
            <div class="card col listing-card">
            <img src="<%= listing.image.url || listing.image %>" class="card-img-top" alt="<%= listing.title %>" style="height: 15rem;"/>
              <div class="card-img-overlay">Views</div>
            <div class="card-body">
            <p class="card-text">
                <b><%= listing.title %></b> <br>
                <small class="text-muted"><%= listing.location %></small> <br>
                &#8377;<%= listing.price.toLocaleString('en-IN') %> / night
                <i class="GST">&nbsp;&nbsp;+18% GST</i>
            </p>
            </div>
            </div>
            </a>
        <% } %>
        <% } else { %>
            <div class="col-12 text-center">
                <div class="alert alert-info">
                    <i class="bi bi-house"></i>
                    <h5>No listings available</h5>
                    <p>There are currently no listings to display.</p>
                </div>
            </div>
        <% } %>
    </div>
    <script src="/js/nav.js"></script>
    <!-- Store listings data for client-side filtering -->
    <script type="application/json" id="listings-data"><%- JSON.stringify(allListings) %></script>
    <!-- External search functionality -->
    <script src="/js/script.js"></script>
</body>
</html>